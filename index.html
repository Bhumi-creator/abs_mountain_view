<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Homestay Booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .homestay {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 40px;
      border-radius: 8px;
    }
    .slider {
      position: relative;
      max-width: 600px;
      margin: 10px auto;
    }
    .slider img {
      width: 100%;
      height: auto;
      border-radius: 5px;
      display: none;
    }
    .slider img.active {
      display: block;
    }
    .slider button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(0,0,0,0.5);
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 20px;
      border-radius: 50%;
    }
    .slider .prev {
      left: 10px;
    }
    .slider .next {
      right: 10px;
    }
    .price-display {
      font-weight: bold;
      margin-top: 10px;
      font-size: 18px;
    }
    input[type="date"] {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>Homestay Booking</h1>
  <div id="homestayList">Loading...</div>

  <script>
    const homestays = [
      {
        name: "Hill View Villa",
        basePrice: 2000,
        images: [
          "https://picsum.photos/id/1018/600/400",
          "https://picsum.photos/id/1019/600/400",
          "https://picsum.photos/id/1020/600/400"
        ]
      },
      {
        name: "Forest Nest",
        basePrice: 1800,
        images: [
          "https://picsum.photos/id/1021/600/400",
          "https://picsum.photos/id/1022/600/400",
          "https://picsum.photos/id/1023/600/400"
        ]
      },
      {
        name: "Lakefront Retreat",
        basePrice: 2200,
        images: [
          "https://picsum.photos/id/1015/600/400",
          "https://picsum.photos/id/1016/600/400",
          "https://picsum.photos/id/1014/600/400"
        ]
      }
    ];

    let pricingData = {};
    const slideIndexMap = {};

    // Load pricing.json
    fetch("pricing.json")
      .then(res => res.json())
      .then(data => {
        pricingData = data;
        renderHomestays();
      })
      .catch(err => {
        document.getElementById("homestayList").innerHTML = `<p style="color:red;">Error loading pricing data: ${err.message}</p>`;
        renderHomestays(); // fallback if no pricing file
      });

    function renderHomestays() {
      const container = document.getElementById("homestayList");
      container.innerHTML = "";

      homestays.forEach((h, idx) => {
        const homestayDiv = document.createElement("div");
        homestayDiv.className = "homestay";

        const imageSlides = h.images.map((img, i) => `
          <img src="${img}" class="slide-${idx} ${i === 0 ? 'active' : ''}" />
        `).join("");

        homestayDiv.innerHTML = `
          <h2>${h.name}</h2>
          <div class="slider" id="slider-${idx}">
            ${imageSlides}
            <button class="prev" onclick="changeSlide(${idx}, -1)">❮</button>
            <button class="next" onclick="changeSlide(${idx}, 1)">❯</button>
          </div>
          <p>Base Price: ₹${h.basePrice}</p>
          <label>Check-in:</label>
          <input type="date" id="checkin-${idx}" />
          <label>Check-out:</label>
          <input type="date" id="checkout-${idx}" />
          <p class="price-display" id="price-${idx}">Select check-in and check-out to calculate price.</p>
        `;

        container.appendChild(homestayDiv);

        // Price calculation
        const checkinInput = homestayDiv.querySelector(`#checkin-${idx}`);
        const checkoutInput = homestayDiv.querySelector(`#checkout-${idx}`);
        const priceDisplay = homestayDiv.querySelector(`#price-${idx}`);

        const calculatePrice = () => {
          const checkin = checkinInput.value;
          const checkout = checkoutInput.value;

          if (!checkin || !checkout) {
            priceDisplay.textContent = "Select check-in and check-out to calculate price.";
            return;
          }

          const startDate = new Date(checkin);
          const endDate = new Date(checkout);

          if (endDate <= startDate) {
            priceDisplay.textContent = "Check-out must be after check-in.";
            return;
          }

          let totalPrice = 0;
          let date = new Date(startDate);
          let missingDates = [];
          let bookedDates = [];

          while (date < endDate) {
            const dateStr = date.toISOString().split('T')[0];
            const priceEntry = pricingData[dateStr]?.[h.name];

            if (priceEntry === "booked") {
              bookedDates.push(dateStr);
            } else if (typeof priceEntry === "number") {
              totalPrice += priceEntry;
            } else {
              totalPrice += h.basePrice;
              missingDates.push(dateStr);
            }

            date.setDate(date.getDate() + 1);
          }

          if (bookedDates.length > 0) {
            priceDisplay.innerHTML = `
              ❌ <strong>${h.name}</strong> is <strong>booked</strong> on: ${bookedDates.join(', ')}.
              <br>Please choose different dates.
            `;
            return;
          }

          priceDisplay.innerHTML = `✅ Total price from <strong>${checkin}</strong> to <strong>${checkout}</strong> is <strong>₹${totalPrice}</strong>.` +
            (missingDates.length > 0 ? `<br/><small>(Used base price for: ${missingDates.join(', ')})</small>` : '');
        };

        checkinInput.addEventListener("change", calculatePrice);
        checkoutInput.addEventListener("change", calculatePrice);
      });
    }

    function changeSlide(index, step) {
      const slides = document.querySelectorAll(`.slide-${index}`);
      if (!slideIndexMap[index]) slideIndexMap[index] = 0;

      // Hide current slide
      slides[slideIndexMap[index]].classList.remove("active");

      // Update index
      slideIndexMap[index] += step;
      if (slideIndexMap[index] >= slides.length) slideIndexMap[index] = 0;
      if (slideIndexMap[index] < 0) slideIndexMap[index] = slides.length - 1;

      // Show new slide
      slides[slideIndexMap[index]].classList.add("active");
    }
  </script>

</body>
</html>
